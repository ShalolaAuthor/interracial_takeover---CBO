# councillor task for 'Great Replacement' action file

great_replacement = {
	position = councillor_marshal
	
	task_type = task_type_county
	county_target = realm
	task_progress = task_progress_percentage
	restart_on_finish = yes
	highlight_own_realm = yes
	
	is_shown = {
		scope:councillor = {
			trigger_if = {
				limit = {
					has_game_rule = bno_great_replacement_converting
				}
				is_culture_bnoc = yes
			}
			trigger_else = {
				scope:councillor_liege = {
					any_realm_county = {
						NOT = { culture = prev.culture }
					}
				}
			}
			OR = {
				is_bbc = yes
				is_bno_snowbunny_and_up = yes
			}
		}
	}
	asset = {
		icon = "gfx/interface/icons/council_task_types/great_replacement.dds"
		background = "gfx/interface/buttons/button_round_bg.dds"
		frame = "gfx/interface/buttons/button_round_frame.dds"
		glow = "gfx/particles/halo.dds"
	}
	
	effect_desc = great_replacement_acceptance_effect_desc
	
	progress = {
		value = 5
		add = {
			value = 0
			add = scope:councillor.martial
			divide = 5
			desc = SCALED_COUNCILLOR_MARTIAL_VALUE
		}
		add = {
			value = 0
			add = scope:councillor.intrigue
			divide = 5
			desc = SCALED_COUNCILLOR_MARTIAL_VALUE
		}
		add = {
			value = 0
			if = {
				limit = {
					has_game_rule = bno_great_replacement_cultural_acceptance
				}
				add = 10
				if = {
					limit = {
						scope:county ?= {
							culture = {
								cultural_acceptance = {
									target = scope:councillor_liege.culture
									value > 25
								}
							}
						}
					}
					add = 25
				}
				if = {
					limit = {
						scope:county ?= {
							culture = {
								cultural_acceptance = {
									target = scope:councillor_liege.culture
									value > 50
								}
							}
						}
					}
					add = 25
				}
				if = {
					limit = {
						scope:county ?= {
							culture = {
								cultural_acceptance = {
									target = scope:councillor_liege.culture
									value > 75
								}
							}
						}
					}
					add = 25
				}
			}
			multiply = 0.9
			desc = bno_great_replacement.current_cultural_acceptance
		}
		subtract = {
			value = 0
			if = {
				limit = {
					scope:county ?= {
						development_level > 0
					}
				}
				add = scope:county.development_level
				divide = 1.2
			}
			desc = STEWARD_PROMOTE_CULTURE_DEVELOPMENT_PENALTY
		}
		min = 1
	}
	
	potential_county = {
		scope:county = {
			trigger_if = {
				limit = {
					has_game_rule = bno_great_replacement_cultural_acceptance
				}
				NOT = { culture = scope:councillor_liege.culture }
				culture = {
					cultural_acceptance = {
						target = scope:councillor_liege.culture
						value < 100
					}
				}
			}
			trigger_else = {
				is_culture_bnoc = no
			}
		}
	}
	
	on_finish_task_county = {
		scope:councillor_liege = {
			culture = {
				save_scope_as = liege_culture
			}
			bno_great_replacement_liege_effect = yes
		}
	}
	
	ai_will_do = {
		value = 0
		if = {
			limit = {
				is_bno_curious_and_up = yes
			}
			add = 10
		}
		else_if = {
			limit = {
				is_bno_qos_and_up = yes
			}
			add = 20
		}
		else_if = {
			limit = {
				is_bno_mindless_bbc_slut = yes
				is_bno_fucked_mindless = yes
			}
			add = 45
		}
		else_if = {
			limit = {
				is_bbc = yes
			}
			add = 75
		}
	}
}
