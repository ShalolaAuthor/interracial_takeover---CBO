namespace = bno_character_initialization

bno_character_initialization.0001 = {
	scope = none
	hidden = yes
	immediate = {
		every_living_character = {
			limit = {
				is_alive = yes
			}
			trigger_event = { on_action = bno_trait_initialization_pulse }
		}
	}
}

namespace = bno_trait_maintenance

#African Traits
bno_trait_maintenance.0001 = {
	hidden = yes
	trigger = {
		is_alive = yes
	}
	immediate = {
		if = {
			limit = {
				NOT = { has_character_flag = bno_traits_seeded }
			}
			add_character_flag = bno_traits_seeded
			if = {
				limit = {
					NOT = { has_trait = bno_blood }
					bno_is_graphically_african = yes
				}
				add_trait = bno_full_black
				bno_seed_originally_african_flag = yes
			}
			else_if = {
				limit = {
					NOT = { exists = mother }
					is_african = yes
				}
				bno_seed_originally_african_flag = yes
			}
		}
		trigger_event = bno_trait_maintenance.0002
	}
}
# BBC Traits
bno_trait_maintenance.0002 = {
	hidden = yes
	immediate = {
		if = {
			limit = {
				has_game_rule = bno_seeding_yes
				NOT = { has_character_flag = bno_bbc_trait_seeded }
			}
			bno_seed_bbc_trait_effect = yes
			bno_futa_bisexual = yes
		}
		trigger_event = bno_trait_maintenance.0003
	}
}
# Make BBC Trait not active if female
bno_trait_maintenance.0003 = {
	hidden = yes
	immediate = {
		bno_make_bbc_trait_inactive = yes
		trigger_event = bno_trait_maintenance.0004
	}
}
# Pussy Mileage Seeding
bno_trait_maintenance.0004 = {
	hidden = yes
	immediate = {
		if = {
			limit = {
				NOT = { has_character_flag = bno_pussy_mileage_trait_seeded }
			}
			add_character_flag = bno_pussy_mileage_trait_seeded
			if = {
				limit = {
					is_female = yes
					NOT = { has_trait = bno_pussy_mileage }
				}
				add_trait = bno_pussy_mileage_1
			}
			if = {
				limit = {
					is_female = yes
					is_married = yes
					any_spouse = {
						is_bbc = yes
					}
				}
				bno_generic_rank_increase = {
					TRAIT_GROUP = bno_pussy_mileage
				}
				add_trait_xp = {
					trait = bno_pussy_mileage_2
					value = bno_random_xp_positive
				}
			}
			if = {
				limit = {
					is_female = yes
					any_child = {
						count >= 1
					}
				}
				every_child = {
					root = {
						add_trait_xp = {
							trait = bno_pussy_mileage_1
							value = bno_random_xp_positive
						}
					}
				}
			}
		}
		trigger_event = bno_trait_maintenance.0005
	}
}
#Seed all character with body trait
bno_trait_maintenance.0005 = {
	hidden = yes
	immediate = {
		bno_seed_body_trait = yes
		trigger_event = bno_trait_maintenance.0006
	}
}
#remove BBC from non african
bno_trait_maintenance.0006 = {
	hidden = yes
	immediate = {
		if = {
			limit = {
				is_bbc = yes
				NOT = { has_trait = bno_blood }
			}
			remove_trait = bno_bbc
		}
		trigger_event = bno_trait_maintenance.0007
	}
}
# add breast size variable
bno_trait_maintenance.0007 = {
	hidden = yes
	immediate = {
		bno_seed_breast_size_variable = yes
		trigger_event = bno_trait_maintenance.0008
	}
}
# convert bbc people to have african culture
bno_trait_maintenance.0008 = {
	hidden = yes
	immediate = {
		if = {
			limit = {
				is_bbc = yes
				is_ai = yes
				is_culture_bnoc = no
				has_game_rule = bno_bbc_forced_conversion_yes
			}
			if = {
				limit = {
					liege ?= {
						is_culture_bnoc = yes
					}
				}
				set_culture = liege.culture
			}
			else = {
				set_culture = culture:bnoc
			}
		}
		trigger_event = bno_trait_maintenance.0009
	}
}
# convert bbc people to church of the black cock
bno_trait_maintenance.0009 = {
	hidden = yes
	immediate = {
		if = {
			limit = {
				is_bbc = yes
				is_ai = yes
				is_faith_bbcs = no
				has_game_rule = bno_religion_yes
				has_game_rule = bno_bbc_forced_conversion_yes
			}
			if = {
				limit = {
					liege ?= {
						is_faith_bbcs = yes
					}
				}
				bno_conversion_effect = {
					FAITH = liege.faith
				}
			}
			else = {
				bno_conversion_effect = {
					FAITH = faith:bbcs
				}
			}
		}
		trigger_event = bno_trait_maintenance.0010
	}
}
# if liege is from Church of the Black Cock convert vassal into liege faith
bno_trait_maintenance.0010 = {
	hidden = yes
	immediate = {
		if = {
			limit = {
				faith = faith:bbcs
				trigger_if = {
					limit = {
						exists = liege
						liege ?= {
							is_faith_bbcs = yes
						}
						NOT = { faith = liege.faith }
					}
					always = yes
				}
				trigger_else = {
					always = no
				}
			}
			set_character_faith_with_conversion = liege.faith
		}
		trigger_event = bno_trait_maintenance.0011
	}
}
# if slut cant have futa
bno_trait_maintenance.0011 = {
	hidden = yes
	immediate = {
		if = {
			limit = {
				is_a_futa = yes
				is_slut = yes
			}
			bno_make_futa_inactive = yes
		}
		trigger_event = bno_trait_maintenance.0012
	}
}
#pure african can't be a slut
bno_trait_maintenance.0012 = {
	hidden = yes
	immediate = {
		if = {
			limit = {
				is_african = yes
				is_slut = yes
			}
			switch = {
				trigger = has_trait
				bno_curious = { remove_trait = bno_curious }
				bno_blacked = { remove_trait = bno_blacked }
				bno_snowbunny = { remove_trait = bno_snowbunny }
				bno_qos = { remove_trait = bno_qos }
				bno_mindless_bbc_slut = { remove_trait = bno_mindless_bbc_slut }
			}
		}
		trigger_event = bno_trait_maintenance.0013
	}
}
#castrated characters should obviously not have dick traits
bno_trait_maintenance.0013 = {
	hidden = yes
	immediate = {
		if = {
			limit = {
				OR = {
					has_trait = bno_castrated
					has_trait = bno_castrated_futa
					has_trait = eunuch
					has_trait = beardless_eunuch
				}
			}
			make_trait_inactive = dick_big_good_1
			make_trait_inactive = dick_big_good_2
			make_trait_inactive = dick_big_good_3
			make_trait_inactive = dick_small_bad_1
			make_trait_inactive = dick_small_bad_2
			make_trait_inactive = dick_small_bad_3
		}
		trigger_event = bno_trait_maintenance.0014
	}
}
#make all non bbc male slaves caged if owner is bbc
bno_trait_maintenance.0014 = {
	hidden = yes
	immediate = {
		if = {
			limit = {
				is_independent_ruler = no
				liege ?= {
					trigger_if = {
						limit = {
							is_a_male = yes
						}
						is_bbc = yes
					}
					trigger_else = {
						is_bno_snowbunny_and_up = yes
						any_spouse = {
							is_bbc = yes
						}
					}
				}
				is_slave = yes
				is_a_male = yes
				is_bbc = no
			}
			if = {
				limit = {
					liege ?= {
						is_bbc = yes
					}
				}
				bno_caged_effect = {
					CAGER = liege
				}
			}
			else = {
				liege ?= {
					random_spouse = {
						limit = {
							is_bbc = yes
						}
						save_scope_as = bbc
					}
				}
				bno_caged_effect = {
					CAGER = scope:bbc
				}
			}
			liege ?= {
				send_interface_message = {
					title = {
						first_valid = {
							triggered_desc = {
								trigger = { is_bbc = yes }
								desc = bno_trait_maintenance.0014.title.bbc
							}
							desc = bno_trait_maintenance.0014.title.slut
						}
					}
					desc = {
						first_valid = {
							triggered_desc = {
								trigger = { is_bbc = yes }
								desc = bno_trait_maintenance.0014.desc.bbc
							}
							desc = bno_trait_maintenance.0014.desc.slut
						}
					}
					right_icon = root
				}
			}
		}
		trigger_event = bno_trait_maintenance.0015
	}
}
#makes all caged characters have tiniest dick
bno_trait_maintenance.0015 = {
	hidden = yes
	immediate = {
		if = {
			limit = {
				has_trait = bno_caged
				NOT = { has_trait = dick_small_bad_3 }
			}
			become_smaller_dick_effect = yes
			random_character_artifact = {
				limit = {
					has_variable = bno_chastity_cage
					creator = {
						is_playable_character = yes
					}
				}
				creator = {
					save_scope_as = cager
				}
			}
			scope:cager ?= {
				send_interface_message = {
					title = {
						first_valid = {
							triggered_desc = {
								trigger = { is_bbc = yes }
								desc = bno_trait_maintenance.0015.title.bbc
							}
							desc = bno_trait_maintenance.0015.title.slut
						}
					}
					desc = {
						first_valid = {
							triggered_desc = {
								trigger = { is_bbc = yes }
								desc = bno_trait_maintenance.0015.desc.bbc
							}
							desc = bno_trait_maintenance.0015.desc.slut
						}
					}
				}
			}
		}
		trigger_event = bno_trait_maintenance.0016
	}
}
#make sure to punish people that unequipped the chastity device
bno_trait_maintenance.0016 = {
	hidden = yes
	immediate = {
		if = {
			limit = {
				has_trait = bno_caged
				any_character_artifact = {
					has_variable = bno_chastity_cage
					is_equipped = no
				}
			}
			random_character_artifact = {
				limit = {
					has_variable = bno_chastity_cage
				}
				equip_artifact_to_owner_replace = yes
			}
			add_character_modifier = bno_withering_manhood
		}
	}
}